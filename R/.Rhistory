### create df where each row represents a pair.
df_by_pair = df_all %>%
group_by(pair, condition, speaker) %>%
summarize_data()
### create df where each row represents a condition.
df_by_cond = df_all %>%
group_by(condition, speaker) %>%
summarize_data()
df_by_cond
### create df where each row represents a pair and a round.
df_by_pair_round = df_all %>%
group_by(pair, condition, round, speaker) %>%
summarize_data()
### create df where each row represents a round.
df_by_round = df_all %>%
group_by(round, speaker) %>%
summarize_data()
df_by_round
### create df where each row represents a condition x round.
df_by_cond_round = df_all %>%
group_by(condition, round, speaker) %>%
summarize_data()
df_by_cond_round
#=====condition=====
df_by_pair_B = df %>%
group_by(pair, condition) %>%
summarize_data()
df_by_cond_B = df %>%
group_by(condition) %>%
summarize_data()
#=====cond*round=====
df_by_pair_round_B = df %>%
group_by(pair, condition, round) %>%
summarize_data()
df_by_round_B = df %>%
group_by(round) %>%
summarize_data()
df_by_cond_round_B = df %>%
group_by(condition, round) %>%
summarize_data()
rcp_distance = df_all %>%
ggplot(aes(x = condition, y = average_distance_xyz,
fill = condition)) +
ggdist::stat_halfeye(adjust = 1, width = 0.3, .width = 0,
point_color = NA, alpha = 0.6, justification = -0.5) +
geom_jitter(aes(x = stage(start = condition, after_scale = x - 0.2)),
size = 0.2, alpha = 0.3, width = 0.07, height = 0) +
geom_boxplot(width = .2,
outlier.shape = NA,
alpha = 0.7,
color = "black") +
geom_point(data = df_by_cond,
aes(y = mean_dis),
shape = 21, size = 3, fill = "white") +
labs(x="Visibility",
y="DTW distance") +
scale_y_continuous(limits = c(0, 1)) +
scale_fill_manual(values = c("#ED6B06", "#00786A", "darkgrey")) +
theme_clean(base_size = 15) +
theme(axis.text.x = element_text(colour = "black", size = 14),
axis.text.y = element_text(colour = "black", size = 14),
axis.title = element_text(size = 15, face = 'bold'),
axis.title.x = element_text(vjust = -2),
axis.title.y = element_text(vjust = 2),
legend.position = "none",
strip.text = element_text(size = 15, face = 'bold'),
plot.background = element_blank(),
plot.margin = unit(c(1.1,1.1,1.1,1.1), "lines")) +
facet_grid(~speaker)
rcp_distance
ggsave("figures/speakerB/dtw/rcp_distance.svg", width=4, height=4, dpi=600)
bp_distance = df_all %>%
ggplot(aes(x = condition, y = average_distance_xyz,
fill = condition)) +
geom_jitter(aes(x = stage(start = condition)),
size = 0.15, alpha = 0.15, width = 0.07, height = 0) +
geom_boxplot(width = .3,
outlier.shape = NA,
alpha = 0.7,
color = "black") +
geom_point(data = df_by_cond,
aes(y = mean_dis),
shape = 21, size = 3, fill = "white") +
labs(x="Visibility",
y="DTW distance") +
scale_y_continuous(limits = c(0, 0.9)) +
scale_fill_manual(values = c("#ED6B06", "#00786A", "darkgrey")) +
theme_clean(base_size = 15) +
theme(axis.text.x = element_text(colour = "black", size = 14),
axis.text.y = element_text(colour = "black", size = 14),
axis.title = element_text(size = 15, face = 'bold'),
axis.title.x = element_text(vjust = -2),
axis.title.y = element_text(vjust = 2),
legend.position = "none",
strip.text = element_text(size = 15, face = 'bold'),
plot.background = element_blank(),
plot.margin = unit(c(1.1,1.1,1.1,1.1), "lines")) +
facet_grid(~speaker)
bp_distance
ggsave("figures/speakerB/dtw/bp_distance.svg", width=4, height=3.5, dpi=600)
bp_distance_by_cond_round =
ggplot(df_all,
aes(x=round, y = average_distance_xyz, fill = condition)) +
geom_jitter(aes(x = stage(start = round)),
size = 0.3, alpha = 0.2, width = 0.07, height = 0.02) +
geom_boxplot(width = .5,
outlier.shape = NA, alpha = 0.7) +
geom_point(data = df_by_cond_round,
aes(y = mean_dis, group = round),
shape = 21, size = 2, fill = "white") +
labs(x = "Round",
y = "DTW distance") +
scale_fill_manual(values = c("#ED6B06", "#00786A", "darkgrey")) +
scale_y_continuous(limits = c(0, 0.9)) +
theme_clean(base_size = 15) +
theme(axis.text.x = element_text(colour = "black", size = 14),
axis.text.y = element_text(colour = "black", size = 14),
axis.title = element_text(size = 15, face = 'bold'),
axis.title.x = element_text(vjust = -2),
axis.title.y = element_text(vjust = 2),
legend.position = "none",
strip.text = element_text(size = 15, face = 'bold'),
plot.background = element_blank(),
plot.margin = unit(c(1.1,1.1,1.1,1.1), "lines")) +
facet_grid(rows = vars(speaker),
cols = vars(condition))
ggplotly(bp_distance_by_cond_round)
ggsave("figures/speakerB/dtw/bp_distance_by_cond_round.svg", width=6.5, height=3.5, dpi=600)
rcp_distance = df %>%
ggplot(aes(x = condition, y = average_distance_xyz,
fill = condition)) +
ggdist::stat_halfeye(adjust = 1, width = 0.3, .width = 0,
point_color = NA, alpha = 0.6, justification = -0.5) +
geom_jitter(aes(x = stage(start = condition, after_scale = x - 0.2)),
size = 0.2, alpha = 0.3, width = 0.07, height = 0) +
geom_boxplot(width = .2,
outlier.shape = NA,
alpha = 0.7,
color = "black") +
geom_point(data = df_by_cond_B,
aes(y = mean_dis),
shape = 21, size = 3, fill = "white") +
labs(x="Visibility",
y="DTW distance") +
scale_y_continuous(limits = c(0, 1)) +
scale_fill_manual(values = c("#ED6B06", "#00786A", "darkgrey")) +
theme_clean(base_size = 15) +
theme(axis.text.x = element_text(colour = "black", size = 14),
axis.text.y = element_text(colour = "black", size = 14),
axis.title = element_text(size = 15, face = 'bold'),
axis.title.x = element_text(vjust = -2),
axis.title.y = element_text(vjust = 2),
legend.position = "none",
strip.text = element_text(size = 15, face = 'bold'),
plot.background = element_blank(),
plot.margin = unit(c(1.1,1.1,1.1,1.1), "lines"))
rcp_distance
ggsave("figures/speakerB/dtw/rcp_distance.svg", width=4, height=4, dpi=600)
bp_distance = df %>%
ggplot(aes(x = condition, y = average_distance_xyz,
fill = condition)) +
geom_jitter(aes(x = stage(start = condition)),
size = 0.15, alpha = 0.15, width = 0.07, height = 0) +
geom_boxplot(width = .3,
outlier.shape = NA,
alpha = 0.7,
color = "black") +
geom_point(data = df_by_cond_B,
aes(y = mean_dis),
shape = 21, size = 3, fill = "white") +
labs(x="Visibility",
y="DTW distance") +
scale_y_continuous(limits = c(0, 0.9)) +
scale_fill_manual(values = c("#ED6B06", "#00786A", "darkgrey")) +
theme_clean(base_size = 15) +
theme(axis.text.x = element_text(colour = "black", size = 14),
axis.text.y = element_text(colour = "black", size = 14),
axis.title = element_text(size = 15, face = 'bold'),
axis.title.x = element_text(vjust = -2),
axis.title.y = element_text(vjust = 2),
legend.position = "none",
strip.text = element_text(size = 15, face = 'bold'),
plot.background = element_blank(),
plot.margin = unit(c(1.1,1.1,1.1,1.1), "lines"))
bp_distance
ggsave("figures/speakerB/dtw/bp_distance.svg", width=4, height=3.5, dpi=600)
bp_distance_by_cond_round =
ggplot(df,
aes(x=round, y = average_distance_xyz, fill = condition)) +
geom_jitter(aes(x = stage(start = round)),
size = 0.3, alpha = 0.2, width = 0.07, height = 0.02) +
geom_boxplot(width = .5,
outlier.shape = NA, alpha = 0.7) +
geom_point(data = df_by_cond_round_B,
aes(y = mean_dis, group = round),
shape = 21, size = 2, fill = "white") +
labs(x = "Round",
y = "DTW distance") +
scale_fill_manual(values = c("#ED6B06", "#00786A", "darkgrey")) +
scale_y_continuous(limits = c(0, 0.9)) +
theme_clean(base_size = 15) +
theme(axis.text.x = element_text(colour = "black", size = 14),
axis.text.y = element_text(colour = "black", size = 14),
axis.title = element_text(size = 15, face = 'bold'),
axis.title.x = element_text(vjust = -2),
axis.title.y = element_text(vjust = 2),
legend.position = "none",
strip.text = element_text(size = 15, face = 'bold'),
plot.background = element_blank(),
plot.margin = unit(c(1.1,1.1,1.1,1.1), "lines")) +
facet_grid(cols = vars(condition))
ggplotly(bp_distance_by_cond_round)
ggsave("figures/speakerB/dtw/bp_distance_by_cond_round.svg", width=6.5, height=3.5, dpi=600)
### dag
grViz(
"digraph {
graph [ranksep = 0.3]
node [shape = plaintext]
X [label = Visibility, fontcolor = forestgreen]
Y [label = DTW_distance, fontcolor = darkorange]
Z [label = Round]
edge [minlen = 2.5]
{X -> Y
Z -> Y}
{rank = same; X; Y}
}"
)
### visibility condition: difference coding
h_cond = hypr(AO_Asym = AsymAV ~ AO,
Asym_Sym = SymAV ~ AsymAV,
levels = levels(df$condition))
h_cond
contrasts(df$condition) = contr.hypothesis(h_cond)
### visibility condition: treatment coding
h_cond = hypr(AO_Sym = SymAV ~ AO,
Asym_Sym = SymAV ~ AsymAV,
levels = levels(df$condition))
h_cond
contrasts(df$condition_sum) = contr.hypothesis(h_cond)
priors_rint_dtw = c(
prior(normal(-0.7, 0.5), class = Intercept),
prior(normal(0, 0.2), class = b),
prior(normal(0, 0.2), class = sd),
prior(normal(0, 0.5), class = sigma))
priors_rslope_dtw = c(
prior(normal(-0.7, 0.5), class = Intercept),
prior(normal(0, 0.2), class = b),
prior(normal(0, 0.2), class = sd),
prior(normal(0, 0.5), class = sigma),
prior(lkj(2), class = cor))
mln_dtw_prior = brm(average_distance_xyz ~ 1 + condition * round_c +
(1+round_c|pair) + (1|target),
family = lognormal(),
prior = priors_rslope_dtw,
sample_prior = "only",
data = df,
file = "models/speakerB/mln_dtw_prior")
pp_check(mln_dtw_prior, ndraws = 100) +
coord_cartesian(xlim = c(0, 3),
ylim = c(0, 10))
mln_dtw = brm(average_distance_xyz ~ 1 + condition * round_c +
(1+round_c|pair) + (1|target),
family = lognormal(),
prior = priors_rslope_dtw,
data = df,
sample_prior = T,
warmup = nwu, iter = niter,
control = list(adapt_delta = 0.9,
max_treedepth = 15),
file = "models/speakerB/mln_dtw")
model = mln_dtw
summary(model)
bayestestR::hdi(model)
# bayestestR::hdi(model, ci = 0.89)
plot_posterior(model)
post_sample = as_draws_df(model)
pp_update_plot(post_sample)
pp_check(model, ndraws = 100) +
coord_cartesian(xlim = c(0, 3))
### varying priors for sensitivity analysis
prior_size = c("xs", "s", "l", "xl")
prior_sd = c(0.05, 0.1, 0.3, 0.5)
bfs_cond_ao_asym = c()
bfs_cond_asym_sym = c()
bfs_round = c()
bfs_ao_asym_round = c()
bfs_asym_sym_round = c()
for (i in 1:length(prior_sd)){
priors = c(
prior(normal(-0.7, 0.5), class = Intercept),
set_prior(paste0("normal(0,", prior_sd[i], ")"), class = "b"),
prior(normal(0, 0.2), class = sd),
prior(normal(0, 0.5), class = sigma),
prior(lkj(2), class = cor))
fname = paste0("models/speakerB/mln_dtw_", prior_size[i])
fit = brm(average_distance_xyz ~ 1 + condition * round_c +
(1+round_c|pair) + (1|target),
family = lognormal(),
prior = priors,
data = df,
sample_prior = T,
save_pars = save_pars(all = TRUE),
warmup = nwu, iter = niter,
control = list(adapt_delta = 0.9,
max_treedepth = 15),
file = fname)
### BF for visibility conditions
# sym - asym
h = hypothesis(fit, "conditionAO_Asym = 0")
bf = 1 / abs(h$hypothesis$Evid.Ratio)
bfs_cond_ao_asym = c(bfs_cond_ao_asym, bf)
# sym - ao
h = hypothesis(fit, "conditionAsym_Sym = 0")
bf = 1 / abs(h$hypothesis$Evid.Ratio)
bfs_cond_asym_sym = c(bfs_cond_asym_sym, bf)
### BF for rounds
h = hypothesis(model, "round_c = 0")
bf = 1 / abs(h$hypothesis$Evid.Ratio)
bfs_round = c(bfs_round, bf)
### BF for interaction
# ao - asym: round
h = hypothesis(model, "conditionAO_Asym:round_c = 0")
bf = 1 / abs(h$hypothesis$Evid.Ratio)
bfs_ao_asym_round = c(bfs_ao_asym_round, bf)
# asym - sym: round
h = hypothesis(model, "conditionAsym_Sym:round_c = 0")
bf = 1 / abs(h$hypothesis$Evid.Ratio)
bfs_asym_sym_round = c(bfs_asym_sym_round, bf)
}
### add BF for the main/medium model
prior_size[3:5] = c("m", prior_size[3:4])
prior_sd[3:5] = c(0.2, prior_sd[3:4])
### BF for visibility
# sym - asym
h = hypothesis(model, "conditionAO_Asym = 0")
bf = 1 / abs(h$hypothesis$Evid.Ratio)
bfs_cond_ao_asym[3:5] = c(bf, bfs_cond_ao_asym[3:4])
# sym - ao
h = hypothesis(model, "conditionAsym_Sym = 0")
bf = 1 / abs(h$hypothesis$Evid.Ratio)
bfs_cond_asym_sym[3:5] = c(bf, bfs_cond_asym_sym[3:4])
### BF for rounds
h = hypothesis(model, "round_c = 0")
bf = 1 / abs(h$hypothesis$Evid.Ratio)
bfs_round[3:5] = c(bf, bfs_round[3:4])
### BF for interaction
# ao - asym: round
h = hypothesis(model, "conditionAO_Asym:round_c = 0")
bf = 1 / abs(h$hypothesis$Evid.Ratio)
bfs_ao_asym_round[3:5] = c(bf, bfs_ao_asym_round[3:4])
# asym - sym: round
h = hypothesis(model, "conditionAsym_Sym:round_c = 0")
bf = 1 / abs(h$hypothesis$Evid.Ratio)
bfs_asym_sym_round[3:5] = c(bf, bfs_asym_sym_round[3:4])
### make a df for BFs
df_bf = data.frame(size = prior_size,
sd = prior_sd,
ao_asym = bfs_cond_ao_asym,
asym_sym = bfs_cond_asym_sym,
round = bfs_round,
ao_asym_round = bfs_ao_asym_round,
asym_sym_round = bfs_asym_sym_round) %>%
mutate(prior = paste0("N(0, ", sd, ")")) %>%
pivot_longer(cols = c("ao_asym", "asym_sym", "round",
"ao_asym_round", "asym_sym_round"),
names_to = "Effect",
values_to = "BF10") %>%
mutate(Predictor = ifelse(grepl("_round", Effect), "Interaction",
ifelse(grepl("round", Effect), "Round", "Visibility")))
df_bf$Effect = recode(df_bf$Effect,
ao_asym = "AO--AsymAV",
asym_sym = "AsymAV--SymAV",
round = "Round",
ao_asym_round = "AO--AsymAV:Round",
asym_sym_round = "AsymAV--SymAV:Round")
#### Plot BFs ####
ggplot(df_bf, aes(x = prior, y = BF10, group = Effect)) +
geom_hline(yintercept = 1, linetype="dashed") +
geom_point(aes(color=Effect)) +
geom_line(aes(color=Effect)) +
theme_bw(base_size = 12)+
theme(legend.position = "top")+
scale_y_log10("Bayes factor (BF10)",
breaks = c(0.001, 0.01, 0.03, 0.1, 0.33, 1, 3, 10, 30, 100, 1e4, 1e5, 1e6, 1e7),
labels = c(0.001, 0.01, 0.03, 0.1, 0.33, 1, 3, 10, 30, 100, 1e4, 1e5, 1e6, 1e7)) +
xlab("prior")
p_direction(model)
emmeans(model, pairwise ~ condition)$contrasts
emmeans(model, pairwise ~ condition, level = 0.89)$contrasts
mln_dtw_sum_prior = brm(average_distance_xyz ~ 1 + condition_sum * round_c +
(1+round_c|pair) + (1|target),
family = lognormal(),
prior = priors_rslope_dtw,
sample_prior = "only",
data = df,
file = "models/speakerB/mln_dtw_sum_prior")
pp_check(mln_dtw_sum_prior, ndraws = 100) +
coord_cartesian(xlim = c(0, 3),
ylim = c(0, 10))
mln_dtw_sum = brm(average_distance_xyz ~ 1 + condition_sum * round_c +
(1+round_c|pair) + (1|target),
family = lognormal(),
prior = priors_rslope_dtw,
data = df,
sample_prior = T,
warmup = nwu, iter = niter,
control = list(adapt_delta = 0.9,
max_treedepth = 15),
file = "models/speakerB/mln_dtw_sum")
model1 = mln_dtw
model = mln_dtw_sum
summary(model)
bayestestR::hdi(model)
# bayestestR::hdi(model, ci = 0.89)
plot_posterior(model1, model)
ggsave("figures/speakerB/dtw/posterior_mln_dtw.svg", width=4.5, height=4, dpi=600)
post_sample = as_draws_df(model)
pp_update_plot(post_sample, interaction = T)
pp_check(model, ndraws = 100) +
coord_cartesian(xlim = c(0, 3))
### varying priors for sensitivity analysis
prior_size = c("xs", "s", "l", "xl")
prior_sd = c(0.05, 0.1, 0.3, 0.5)
bfs_cond_ao_sym = c()
bfs_ao_sym_round = c()
for (i in 1:length(prior_sd)){
priors = c(
prior(normal(-0.7, 0.5), class = Intercept),
set_prior(paste0("normal(0,", prior_sd[i], ")"), class = "b"),
prior(normal(0, 0.2), class = sd),
prior(normal(0, 0.5), class = sigma),
prior(lkj(2), class = cor))
fname = paste0("models/speakerB/mln_dtw_sum_", prior_size[i])
fit = brm(average_distance_xyz ~ 1 + condition_sum * round_c +
(1+round_c|pair) + (1|target),
family = lognormal(),
prior = priors,
data = df,
sample_prior = T,
save_pars = save_pars(all = TRUE),
warmup = nwu, iter = niter,
control = list(adapt_delta = 0.9,
max_treedepth = 15),
file = fname)
# BF for sym - ao
h = hypothesis(fit, "condition_sumAO_Sym = 0")
bf = 1 / abs(h$hypothesis$Evid.Ratio)
bfs_cond_ao_sym = c(bfs_cond_ao_sym, bf)
### BF for interaction
# ao - sym: round
h = hypothesis(model, "condition_sumAO_Sym:round_c = 0")
bf = 1 / abs(h$hypothesis$Evid.Ratio)
bfs_ao_sym_round = c(bfs_ao_sym_round, bf)
}
### add BF for the main/medium model
prior_size[3:5] = c("m", prior_size[3:4])
prior_sd[3:5] = c(0.2, prior_sd[3:4])
# BF for sym - ao
h = hypothesis(model, "condition_sumAO_Sym = 0")
bf = 1 / abs(h$hypothesis$Evid.Ratio)
bfs_cond_ao_sym[3:5] = c(bf, bfs_cond_ao_sym[3:4])
# ao - sym: round
h = hypothesis(model, "condition_sumAO_Sym:round_c = 0")
bf = 1 / abs(h$hypothesis$Evid.Ratio)
bfs_ao_sym_round[3:5] = c(bf, bfs_ao_sym_round[3:4])
### make a df for BFs
df_bf_temp = data.frame(size = prior_size,
sd = prior_sd,
ao_sym = bfs_cond_ao_sym,
ao_sym_round = bfs_ao_sym_round) %>%
mutate(prior = paste0("N(0, ", sd, ")")) %>%
pivot_longer(cols = c("ao_sym", "ao_sym_round"),
names_to = "Effect",
values_to = "BF10") %>%
mutate(Predictor = ifelse(grepl("_round", Effect), "Interaction", "Visibility"))
df_bf_temp$Effect = recode(df_bf_temp$Effect,
ao_sym = "AO--SymAV",
ao_sym_round = "AO--SymAV:Round")
df_bf_new = df_bf %>%
rbind(df_bf_temp) %>%
mutate(Effect = factor(Effect,
levels = c("AO--SymAV", "AO--AsymAV", "AsymAV--SymAV", "Round",
"AO--SymAV:Round", "AO--AsymAV:Round", "AsymAV--SymAV:Round")),
Predictor = factor(Predictor,
levels = c("Visibility", "Round", "Interaction")))
df_bf_new %>% arrange(Effect, sd)
#### Plot BFs ####
ggplot(filter(df_bf_new, Predictor != "Interaction"),
aes(x = factor(sd), y = BF10, group = Effect)) +
geom_hline(yintercept = 1, linetype="dashed") +
geom_point(aes(color=Effect)) +
geom_line(aes(color=Effect)) +
facet_wrap(vars(Predictor)) +
theme_clean(base_size = 15) +
theme(axis.text.x = element_text(colour = "black", size = 14),
axis.text.y = element_text(colour = "black", size = 14),
axis.title = element_text(size = 15, face = 'bold'),
axis.title.x = element_text(vjust = -2),
axis.title.y = element_text(vjust = 2),
legend.position = "top",
strip.text = element_text(size = 15, face = 'bold'),
plot.background = element_blank(),
plot.margin = unit(c(1.1,1.1,1.1,1.1), "lines")) +
scale_y_log10("Bayes factor (BF10)",
limits = c(0.1, 3),
breaks = c(0.001, 0.03, 0.01, 0.1, 0.33, 1, 3, 10, 30, 100),
labels = c(0.001, 0.03, 0.01, 0.1, 0.33, 1, 3, 10, 30, 100)) +
guides(color = guide_legend(ncol = 3)) +
xlab("SD for the prior")
ggsave("figures/speakerB/dtw/bayes_factor_dtw.svg", width=6, height=4, dpi=600)
p_direction(model)
sessionInfo()
